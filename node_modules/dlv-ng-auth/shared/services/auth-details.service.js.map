{"version":3,"file":"auth-details.service.js","sourceRoot":"","sources":["../../../tmp/src-inlined/shared/services/auth-details.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, EventEmitter } from '@angular/core';\nimport { JwtHelperService } from '@auth0/angular-jwt';\n\nimport 'rxjs/add/operator/catch';\nimport 'rxjs/add/operator/map';\nimport 'rxjs/add/operator/toPromise';\n\nimport { CookiesService } from '../services/cookies.service';\n\n@Injectable()\nexport class AuthDetailsService {\n    private userDetails;\n    private jwtHelper: JwtHelperService = new JwtHelperService();\n    private loginEmitter = new EventEmitter<any>();\n\n    private jwt = '';\n    private callBackUrl = '';\n    private isLoggedEmitter = new EventEmitter<any>();\n    // default values for this options;\n    private options = {\n        loginMessage: 'Redirecting to the login page, Please wait...',\n        needGoogleLogin: true,\n        needPasswordLogin: true,\n        interceptRequests: true,\n        needOtpLogin: true,\n        needForgotPasswordLogin: true,\n        environment: '',\n        onUnAuthorized: null,\n        bodyParams: null\n    };\n\n    private baseTokenName: string = 'ums_token';\n\n    // defaults for env constants, that can be overridden by passing env object with same\n    //keynames to options.\n    private apiConstant = {\n        'dev': 'https://api-stage-ums.delhivery.com',\n        'prod': 'https://api-ums.delhivery.com',\n        'staging': 'https://api-stage-ums.delhivery.com',\n        'qa': 'https://api-stage-ums.delhivery.com',\n    }\n\n\n    private redirectLoginURLs = {\n        'dev': 'https://dev-signin.delhivery.com',\n        'prod': 'https://signin.delhivery.com',\n        'staging': 'https://dev-signin.delhivery.com',\n        'qa': 'https://dev-signin.delhivery.com',\n    }\n\n\n    private userProfileSetEmitter: EventEmitter<any> = new EventEmitter<any>();\n    private changePasswordEmit: EventEmitter<any> = new EventEmitter<any>();\n\n    constructor(private cookies: CookiesService) { }\n\n    public setAuthConstants(customOptions) {\n\n        Object.assign(this.options, customOptions);\n        Object.assign(this.apiConstant, customOptions.env);\n        Object.assign(this.redirectLoginURLs, customOptions.redirectLoginURLs);\n        this.setCookieName();\n    }\n\n    public getAuthConstants() {\n        return this.options\n    };\n\n\n    public setCookieName() {\n        if (this.options['environment'] !== 'prod') {\n            this.options['tokenCookieName'] = `${this.options['environment']}_${this.baseTokenName}`;\n        } else {\n            this.options['tokenCookieName'] = `${this.baseTokenName}`;\n        }\n    };\n\n\n    public getApiURL() {\n        return this.apiConstant[this.options['environment']];\n    };\n\n\n    public getRedirectURL() {\n        return this.redirectLoginURLs[this.options['environment']];\n    };\n\n\n    public checkforErrors = function () {\n        if (!this.options.environment) {\n            setTimeout(function () {\n                throw new Error('Please set the current environment in the LoginService init function in root component options in \"environment\" key, Refer to demo for details');\n            });\n        }\n    };\n\n\n    private getSubDomainName() {\n        let parts = location.hostname.split('.');\n        let subdomain = parts.shift();\n\n        if (!parts.length) {\n            return 'localhost';\n        } else if (subdomain === '127') {\n            return '127.0.0.1';\n        } else {\n            return parts.join('.');\n        }\n    };\n\n\n    public isAuthenticated() {\n        this.checkforErrors();\n        let token = this.getJWT();\n        if (!token || (token && this.jwtHelper.isTokenExpired(token))) {\n            this.deleteJWT();\n            return false;\n        } else {\n            return true;\n        }\n    };\n\n\n    private afterUserValidate(jwtToken, config) {\n        // local variable accessible across the $get method.\n        let token;\n\n        if (!this.jwt) {\n            this.jwt = jwtToken;\n        }\n        token = this.jwt;\n\n        if (config && config.store) {\n\n            this.cookies.store(this.options['tokenCookieName'], token, this.jwtHelper.getTokenExpirationDate(token), this.getSubDomainName());\n        }\n    };\n\n    //  GetJwt from cookies\n    public getJWT() {\n        if (this.jwt) {\n            return this.jwt;\n        } else if (this.cookies.get(this.options['tokenCookieName'])) {\n            return this.cookies.get(this.options['tokenCookieName']);\n        } else {\n            return false;\n        }\n    };\n\n\n    public login(config) {\n        if (config.type === 'local-social') {\n            // save JWT\n            this.setCookieName();\n            this.afterUserValidate(config.jwt, { store: true });\n            this.loginEmitter.emit(true);\n        }\n    };\n\n    public loginStatus() {\n        return this.loginEmitter;\n    }\n\n    //  Delete Jwt from cookies\n    public deleteJWT() {\n        this.cookies.del(this.options['tokenCookieName'], this.getSubDomainName());\n    };\n\n    public setOn401() {\n        this.isLoggedEmitter.emit('true');\n    }\n\n    public getOn401() {\n        return this.isLoggedEmitter;\n    }\n\n\n    public setCallBackUrl(url?) {\n        this.callBackUrl = url;\n    };\n\n    public getCallBackUrl() {\n        return this.callBackUrl;\n    };\n\n    public call403() {\n\n        if (typeof this.options['onUnAuthorized'] === 'function') {\n            this.options['onUnAuthorized']();\n        } else {\n            alert('Unauthorized Action');\n        }\n    }\n\n    public call401() {\n        this.deleteJWT();\n        if (typeof this.options['on401Action'] === 'function') {\n            this.options['on401Action']();\n        } else {\n            alert('Unauthorized access!!! Application logging out.');\n            location.reload();\n        }\n    }\n};\n\n"]}